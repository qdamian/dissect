language: python
python:
  - 2.7
install:
  # Dependencies
    - pip install -r requirements.txt --use-mirrors --quiet
    # Workaround https://github.com/travis-ci/travis-cookbooks/issues/155
    - sudo rm -rf /dev/shm && sudo ln -s /run/shm /dev/shm
script:
  # Lint
    - pylint --rcfile=.pylintrc dissect
  # Unit test
    - nosetests --config .noserc
  # Build
    - rm -rf build
    - python setup.py sdist
  # Install
    - python setup.py install
  # Integration test
    - behave test/system/features
after_success:
  # Report
    - coveralls

deploy:
  provider: pypi
  user: qdamian
  password:
    secure: Sva5QdVZQPEBEH6KMEz4n/zThCUwk4dBkzT9Vq6oh9y+FeuS/TH9dJ+ekD2Ucj/Rlx4LwOHKoW9GRswq2OAy5vha0U6KfRvLNMQZNaUWhOO/Uixzy/x7R+YWuiWxLc4LWVlVtpnTZS/5i2hLIyPxVUTat2irc/cBiKiBFDPfH2Q=
  server: https://testpypi.python.org/pypi
  on:
    tags: true
